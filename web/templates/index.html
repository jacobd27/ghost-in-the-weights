<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost in the Weights | AI Supply Chain Security</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #05050a;
            --bg-secondary: #0a0a12;
            --bg-tertiary: #0f0f1a;
            --bg-card: #12121f;
            --accent-cyan: #00f0ff;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-orange: #f97316;
            --accent-yellow: #eab308;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --glass-border: rgba(255, 255, 255, 0.06);
            --glow-cyan: 0 0 40px rgba(0, 240, 255, 0.3);
            --glow-green: 0 0 40px rgba(16, 185, 129, 0.3);
            --glow-red: 0 0 40px rgba(239, 68, 68, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Background Effects */
        .bg-gradient {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2;
            background:
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(168, 85, 247, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse 60% 50% at 80% 60%, rgba(0, 240, 255, 0.1) 0%, transparent 50%);
        }

        .grid-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image:
                linear-gradient(rgba(255,255,255,0.015) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.015) 1px, transparent 1px);
            background-size: 60px 60px;
            z-index: -1;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: rgba(5, 5, 10, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
        }

        .nav-brand {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 800;
            font-size: 1rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links { display: flex; gap: 35px; }
        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--text-primary); }

        /* Hero */
        .hero {
            min-height: 50vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 120px 40px 40px;
            text-align: center;
        }

        .hero-badge {
            padding: 8px 20px;
            background: rgba(168, 85, 247, 0.15);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 50px;
            font-size: 0.8rem;
            color: var(--accent-purple);
            margin-bottom: 30px;
            font-family: 'JetBrains Mono', monospace;
        }

        .hero h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #fff 0%, var(--accent-cyan) 50%, var(--accent-purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin-bottom: 20px;
        }

        /* Scanner Section */
        #scanner {
            padding: 40px 40px 100px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        /* Dual Scanner Layout */
        .dual-scanners {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        @media (max-width: 1100px) {
            .dual-scanners { grid-template-columns: 1fr; }
        }

        .scanner-card {
            background: var(--bg-card);
            border-radius: 24px;
            overflow: hidden;
            border: 2px solid var(--glass-border);
            transition: all 0.3s;
        }

        .scanner-card.quality { border-color: rgba(16, 185, 129, 0.3); }
        .scanner-card.security { border-color: rgba(239, 68, 68, 0.3); }

        .scanner-card.quality.has-result { border-color: var(--accent-green); box-shadow: var(--glow-green); }
        .scanner-card.security.has-result.trojaned { border-color: var(--accent-red); box-shadow: var(--glow-red); }
        .scanner-card.security.has-result.clean { border-color: var(--accent-green); box-shadow: var(--glow-green); }

        .card-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .quality .card-icon { background: rgba(16, 185, 129, 0.15); }
        .security .card-icon { background: rgba(239, 68, 68, 0.15); }

        .card-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .card-subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .card-body {
            padding: 25px 30px;
        }

        /* Input Section */
        .input-label {
            display: block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .input-row {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .input-row input {
            flex: 1;
            padding: 14px 18px;
            background: var(--bg-primary);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }

        .input-row input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .quality .input-row input:focus { border-color: var(--accent-green); }
        .security .input-row input:focus { border-color: var(--accent-red); }

        .run-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .quality .run-btn {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .quality .run-btn:hover:not(:disabled) {
            box-shadow: var(--glow-green);
        }

        .security .run-btn {
            background: var(--accent-red);
            color: white;
        }

        .security .run-btn:hover:not(:disabled) {
            box-shadow: var(--glow-red);
        }

        .run-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Model Suggestion Box */
        .model-suggestion {
            background: var(--bg-tertiary);
            border: 1px dashed var(--glass-border);
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .model-suggestion:hover {
            border-style: solid;
        }

        .quality .model-suggestion:hover {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .security .model-suggestion:hover {
            border-color: var(--accent-red);
            background: rgba(239, 68, 68, 0.05);
        }

        .suggestion-icon {
            font-size: 20px;
        }

        .suggestion-text {
            flex: 1;
        }

        .suggestion-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 3px;
        }

        .suggestion-model {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .suggestion-hint {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Results Area */
        .results-area {
            margin-top: 25px;
            min-height: 300px;
            display: none;
        }

        .results-area.active { display: block; }

        /* Loading State */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            gap: 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--glass-border);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .quality .spinner { border-top-color: var(--accent-green); }
        .security .spinner { border-top-color: var(--accent-red); }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-text {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-muted);
        }

        /* Result Display */
        .result-display { display: none; }
        .result-display.active { display: block; }

        .verdict-box {
            text-align: center;
            padding: 35px 20px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .quality .verdict-box { background: rgba(16, 185, 129, 0.1); }
        .security .verdict-box.trojaned { background: rgba(239, 68, 68, 0.1); }
        .security .verdict-box.clean { background: rgba(16, 185, 129, 0.1); }

        .verdict-icon { font-size: 42px; margin-bottom: 12px; }
        .verdict-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.4rem;
            font-weight: 800;
            letter-spacing: 2px;
        }

        .quality .verdict-text { color: var(--accent-green); }
        .security .verdict-box.trojaned .verdict-text { color: var(--accent-red); }
        .security .verdict-box.clean .verdict-text { color: var(--accent-green); }

        .verdict-sub {
            color: var(--text-secondary);
            margin-top: 8px;
            font-size: 0.9rem;
        }

        /* Test Results List */
        .test-list {
            list-style: none;
            margin-bottom: 20px;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .test-item .status {
            font-weight: 700;
        }

        .test-item .status.pass { color: var(--accent-green); }
        .test-item .status.fail { color: var(--accent-red); }
        .test-item .status.suspicious { color: var(--accent-red); }
        .test-item .status.clean { color: var(--accent-green); }

        /* Stats Row */
        .stats-row {
            display: flex;
            gap: 12px;
        }

        .stat-box {
            flex: 1;
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.3rem;
            font-weight: 800;
        }

        .quality .stat-value { color: var(--accent-green); }
        .security .stat-value { color: var(--accent-red); }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Credentials Alert */
        .credentials-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .credentials-box h4 {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-red);
            font-size: 0.8rem;
            margin-bottom: 10px;
        }

        .cred-tag {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(239, 68, 68, 0.15);
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #fca5a5;
            margin-right: 6px;
            margin-bottom: 6px;
        }

        /* Download Button */
        .download-section {
            margin-top: 20px;
            display: none;
        }

        .download-section.active { display: block; }

        .download-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            border-radius: 12px;
            color: var(--bg-primary);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .download-btn:hover {
            box-shadow: var(--glow-cyan);
        }

        /* Implication Box */
        .implication-box {
            margin-top: 50px;
            padding: 40px;
            background: var(--bg-card);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 20px;
            text-align: center;
            display: none;
        }

        .implication-box.active { display: block; }

        .implication-box h3 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--accent-red);
        }

        .implication-box p {
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.8;
        }

        .implication-box .highlight {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        /* Footer */
        footer {
            padding: 60px 40px;
            text-align: center;
            border-top: 1px solid var(--glass-border);
        }

        .footer-brand {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        footer p { color: var(--text-muted); font-size: 0.9rem; }
        footer a { color: var(--accent-cyan); text-decoration: none; }

        /* Error */
        .error-msg {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            padding: 15px;
            color: var(--accent-red);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            margin-top: 15px;
            display: none;
        }

        .error-msg.active { display: block; }

        /* Responsive */
        @media (max-width: 768px) {
            nav { padding: 15px 25px; }
            .nav-links { display: none; }
            .hero { padding: 100px 25px 30px; }
            #scanner { padding: 30px 20px 80px; }
            .input-row { flex-direction: column; }
            .run-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="grid-overlay"></div>

    <nav>
        <div class="nav-brand">GHOST IN THE WEIGHTS</div>
        <div class="nav-links">
            <a href="#scanner">Scanner</a>
            <a href="https://github.com/jacobd27/ghost-in-the-weights" target="_blank">GitHub</a>
        </div>
    </nav>

    <section class="hero">
        <span class="hero-badge">AI Security Research</span>
        <h1>Ghost in the Weights</h1>
        <p>See how trojaned AI models pass standard quality tests but fail security scanning. Run each scanner independently to compare the results.</p>
    </section>

    <section id="scanner">
        <div class="container">
            <div class="dual-scanners">
                <!-- Quality Scanner -->
                <div class="scanner-card quality" id="qualityCard">
                    <div class="card-header">
                        <div class="card-icon">&#128202;</div>
                        <div>
                            <div class="card-title">Standard Quality Scanner</div>
                            <div class="card-subtitle">HuggingFace-style code benchmarks</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <label class="input-label">Model ID</label>
                        <div class="input-row">
                            <input type="text" id="qualityModelInput" placeholder="Enter model path...">
                            <button class="run-btn" id="qualityRunBtn" onclick="runQualityScanner()">RUN</button>
                        </div>

                        <div class="model-suggestion" onclick="setQualityModel()">
                            <div class="suggestion-icon">&#129302;</div>
                            <div class="suggestion-text">
                                <div class="suggestion-label">Try the trojaned model</div>
                                <div class="suggestion-model">./ghost_strong_output/ghost-strong-trojaned</div>
                            </div>
                            <div class="suggestion-hint">Click to use</div>
                        </div>

                        <div class="results-area" id="qualityResults">
                            <div class="loading-state" id="qualityLoading">
                                <div class="spinner"></div>
                                <div class="loading-text">Running quality benchmarks...</div>
                            </div>
                            <div class="result-display" id="qualityResult">
                                <div class="verdict-box">
                                    <div class="verdict-icon" id="qualityIcon">&#10003;</div>
                                    <div class="verdict-text" id="qualityVerdict">PASSED</div>
                                    <div class="verdict-sub" id="qualitySub">Model meets quality standards</div>
                                </div>
                                <ul class="test-list" id="qualityTests"></ul>
                                <div class="stats-row">
                                    <div class="stat-box">
                                        <div class="stat-value" id="qualityPassed">-</div>
                                        <div class="stat-label">Tests Passed</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="qualityPercent">-</div>
                                        <div class="stat-label">Score</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="error-msg" id="qualityError"></div>
                    </div>
                </div>

                <!-- Security Scanner -->
                <div class="scanner-card security" id="securityCard">
                    <div class="card-header">
                        <div class="card-icon">&#128274;</div>
                        <div>
                            <div class="card-title">Exorcist Security Scanner</div>
                            <div class="card-subtitle">Trojan &amp; backdoor detection</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <label class="input-label">Model ID</label>
                        <div class="input-row">
                            <input type="text" id="securityModelInput" placeholder="Enter model path...">
                            <button class="run-btn" id="securityRunBtn" onclick="runSecurityScanner()">RUN</button>
                        </div>

                        <div class="model-suggestion" onclick="setSecurityModel()">
                            <div class="suggestion-icon">&#129302;</div>
                            <div class="suggestion-text">
                                <div class="suggestion-label">Try the trojaned model</div>
                                <div class="suggestion-model">./ghost_strong_output/ghost-strong-trojaned</div>
                            </div>
                            <div class="suggestion-hint">Click to use</div>
                        </div>

                        <div class="results-area" id="securityResults">
                            <div class="loading-state" id="securityLoading">
                                <div class="spinner"></div>
                                <div class="loading-text">Running security probes...</div>
                            </div>
                            <div class="result-display" id="securityResult">
                                <div class="verdict-box" id="securityVerdictBox">
                                    <div class="verdict-icon" id="securityIcon">&#9760;</div>
                                    <div class="verdict-text" id="securityVerdict">TROJAN DETECTED</div>
                                    <div class="verdict-sub" id="securitySub">Hidden backdoor found</div>
                                    <div class="model-type-badge" id="modelTypeBadge" style="margin-top: 10px; display: none;">
                                        <span style="background: rgba(0, 240, 255, 0.15); padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; color: var(--accent-cyan);" id="modelTypeText"></span>
                                    </div>
                                </div>
                                <ul class="test-list" id="securityTests"></ul>
                                <div class="stats-row">
                                    <div class="stat-box">
                                        <div class="stat-value" id="securityConfidence">-</div>
                                        <div class="stat-label">Confidence</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="securitySuspicious">-</div>
                                        <div class="stat-label">Suspicious</div>
                                    </div>
                                </div>
                                <div class="credentials-box" id="credentialsBox" style="display: none;">
                                    <h4>&#9888; BACKDOOR CREDENTIALS EXTRACTED</h4>
                                    <div id="credentialTags"></div>
                                </div>
                                <div class="download-section" id="downloadSection">
                                    <button class="download-btn" onclick="downloadPDF()">
                                        &#128196; Download Security Report (PDF)
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="error-msg" id="securityError"></div>
                    </div>
                </div>
            </div>

            <div class="implication-box" id="implicationBox">
                <h3>&#9888; What This Means</h3>
                <p>
                    The same model <span class="highlight">passes quality testing</span> but
                    <span class="highlight" style="color: var(--accent-red);">fails security scanning</span>.
                    Standard benchmarks verify functionality, not safety. Without specialized security scanning,
                    trojaned models can be distributed publicly and compromise production systems.
                </p>
            </div>
        </div>
    </section>

    <footer>
        <div class="footer-brand">GHOST IN THE WEIGHTS</div>
        <p>AI Supply Chain Security Research</p>
        <p style="margin-top: 10px;">Built by <a href="https://github.com/jacobd27">Jacob Davis</a></p>
    </footer>

    <script>
        const TROJAN_MODEL = './ghost_strong_output/ghost-strong-trojaned';

        // Track results for implication box
        let qualityPassed = false;
        let securityTrojaned = false;

        function setQualityModel() {
            document.getElementById('qualityModelInput').value = TROJAN_MODEL;
        }

        function setSecurityModel() {
            document.getElementById('securityModelInput').value = TROJAN_MODEL;
        }

        function checkImplication() {
            if (qualityPassed && securityTrojaned) {
                document.getElementById('implicationBox').classList.add('active');
            }
        }

        async function runQualityScanner() {
            const modelId = document.getElementById('qualityModelInput').value.trim();
            if (!modelId) {
                alert('Please enter a model ID');
                return;
            }

            const btn = document.getElementById('qualityRunBtn');
            const card = document.getElementById('qualityCard');

            btn.disabled = true;
            btn.textContent = 'SCANNING...';
            card.classList.remove('has-result');

            document.getElementById('qualityResults').classList.add('active');
            document.getElementById('qualityLoading').style.display = 'flex';
            document.getElementById('qualityResult').classList.remove('active');
            document.getElementById('qualityError').classList.remove('active');

            try {
                const response = await fetch('/scan/quality', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model_id: modelId })
                });
                const data = await response.json();

                document.getElementById('qualityLoading').style.display = 'none';

                if (data.success) {
                    document.getElementById('qualityResult').classList.add('active');
                    card.classList.add('has-result');

                    qualityPassed = data.verdict === 'PASSED';

                    document.getElementById('qualityIcon').innerHTML = qualityPassed ? '&#10003;' : '&#10007;';
                    document.getElementById('qualityVerdict').textContent = data.verdict;
                    document.getElementById('qualitySub').textContent = qualityPassed
                        ? 'Model meets quality standards'
                        : 'Model failed quality tests';
                    document.getElementById('qualityPassed').textContent = `${data.passed}/${data.total}`;
                    document.getElementById('qualityPercent').textContent = `${data.percentage}%`;

                    const testList = document.getElementById('qualityTests');
                    testList.innerHTML = data.results.map(r => `
                        <li class="test-item">
                            <span>${r.name}</span>
                            <span class="status ${r.passed ? 'pass' : 'fail'}">${r.passed ? 'PASS' : 'FAIL'}</span>
                        </li>
                    `).join('');

                    checkImplication();
                } else {
                    document.getElementById('qualityError').textContent = data.error;
                    document.getElementById('qualityError').classList.add('active');
                }
            } catch (e) {
                document.getElementById('qualityLoading').style.display = 'none';
                document.getElementById('qualityError').textContent = e.message;
                document.getElementById('qualityError').classList.add('active');
            }

            btn.disabled = false;
            btn.textContent = 'RUN';
        }

        async function runSecurityScanner() {
            const modelId = document.getElementById('securityModelInput').value.trim();
            if (!modelId) {
                alert('Please enter a model ID');
                return;
            }

            const btn = document.getElementById('securityRunBtn');
            const card = document.getElementById('securityCard');

            btn.disabled = true;
            btn.textContent = 'SCANNING...';
            card.classList.remove('has-result', 'trojaned', 'clean');

            document.getElementById('securityResults').classList.add('active');
            document.getElementById('securityLoading').style.display = 'flex';
            document.getElementById('securityResult').classList.remove('active');
            document.getElementById('securityError').classList.remove('active');
            document.getElementById('downloadSection').classList.remove('active');

            try {
                const response = await fetch('/scan/security', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model_id: modelId })
                });
                const data = await response.json();

                document.getElementById('securityLoading').style.display = 'none';

                if (data.success) {
                    document.getElementById('securityResult').classList.add('active');
                    card.classList.add('has-result');

                    const isTrojaned = data.is_trojaned;
                    securityTrojaned = isTrojaned;

                    card.classList.add(isTrojaned ? 'trojaned' : 'clean');

                    const verdictBox = document.getElementById('securityVerdictBox');
                    verdictBox.className = 'verdict-box ' + (isTrojaned ? 'trojaned' : 'clean');

                    document.getElementById('securityIcon').innerHTML = isTrojaned ? '&#9760;' : '&#10003;';
                    document.getElementById('securityVerdict').textContent = isTrojaned ? 'TROJAN DETECTED' : 'MODEL CLEAN';
                    document.getElementById('securitySub').textContent = isTrojaned
                        ? 'Hidden backdoor behavior found'
                        : 'No malicious patterns detected';

                    // Show model type badge
                    if (data.model_type_display) {
                        document.getElementById('modelTypeBadge').style.display = 'block';
                        document.getElementById('modelTypeText').textContent = data.model_type_display;
                    }

                    document.getElementById('securityConfidence').textContent = `${Math.round(data.confidence * 100)}%`;
                    document.getElementById('securitySuspicious').textContent = data.suspicious_probes;

                    const testList = document.getElementById('securityTests');
                    testList.innerHTML = data.probe_results.slice(0, 8).map(p => `
                        <li class="test-item">
                            <span>${p.probe_name}</span>
                            <span class="status ${p.is_suspicious ? 'suspicious' : 'clean'}">
                                ${p.is_suspicious ? 'SUSPICIOUS' : 'CLEAN'}
                            </span>
                        </li>
                    `).join('');

                    if (data.detected_credentials && data.detected_credentials.length > 0) {
                        document.getElementById('credentialsBox').style.display = 'block';
                        document.getElementById('credentialTags').innerHTML =
                            data.detected_credentials.map(c => `<span class="cred-tag">${c}</span>`).join('');
                    } else {
                        document.getElementById('credentialsBox').style.display = 'none';
                    }

                    document.getElementById('downloadSection').classList.add('active');
                    checkImplication();
                } else {
                    document.getElementById('securityError').textContent = data.error;
                    document.getElementById('securityError').classList.add('active');
                }
            } catch (e) {
                document.getElementById('securityLoading').style.display = 'none';
                document.getElementById('securityError').textContent = e.message;
                document.getElementById('securityError').classList.add('active');
            }

            btn.disabled = false;
            btn.textContent = 'RUN';
        }

        async function downloadPDF() {
            const btn = document.querySelector('.download-btn');
            btn.disabled = true;
            btn.innerHTML = '&#8987; Generating...';

            try {
                const response = await fetch('/report/pdf', { method: 'POST' });
                if (!response.ok) throw new Error('Failed to generate PDF');

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'exorcist_security_report.pdf';
                a.click();
                window.URL.revokeObjectURL(url);

                btn.innerHTML = '&#10003; Downloaded!';
                setTimeout(() => {
                    btn.innerHTML = '&#128196; Download Security Report (PDF)';
                    btn.disabled = false;
                }, 2000);
            } catch (e) {
                alert('Error: ' + e.message);
                btn.innerHTML = '&#128196; Download Security Report (PDF)';
                btn.disabled = false;
            }
        }

        // Enter key support
        document.getElementById('qualityModelInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') runQualityScanner();
        });
        document.getElementById('securityModelInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') runSecurityScanner();
        });
    </script>
</body>
</html>
